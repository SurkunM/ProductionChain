"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[347],{3347:function(e,t,o){o.r(t),o.d(t,{default:function(){return v}});var r=o(6768),s=o(5130),l=o(4232);const i=["onClick"];function a(e,t,o,a,d,u){const n=(0,r.g2)("v-progress-linear"),c=(0,r.g2)("v-snackbar"),m=(0,r.g2)("v-icon"),h=(0,r.g2)("v-btn"),p=(0,r.g2)("v-text-field"),k=(0,r.g2)("v-chip"),g=(0,r.g2)("v-data-table"),v=(0,r.g2)("v-pagination"),C=(0,r.g2)("v-card"),_=(0,r.g2)("production-task-create-modal");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(C,{title:"Очередь производства",flat:""},{text:(0,r.k6)((()=>[(0,r.bF)(p,{modelValue:d.term,"onUpdate:modelValue":t[2]||(t[2]=e=>d.term=e),label:"Найти",autocomplete:"off","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",onKeyup:(0,s.jR)(u.search,["enter"])},{"append-inner":(0,r.k6)((()=>[(0,r.bF)(h,{icon:"",onClick:u.search,color:"primary",size:"small"},{default:(0,r.k6)((()=>[(0,r.bF)(m,null,{default:(0,r.k6)((()=>t[8]||(t[8]=[(0,r.eW)("mdi-magnify")]))),_:1,__:[8]})])),_:1},8,["onClick"]),(0,r.bF)(m,{onClick:u.cancelSearch,style:{cursor:"pointer"},size:"x-large",class:"ms-1 me-2"},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.eW)(" mdi-close-circle ")]))),_:1,__:[9]},8,["onClick"])])),_:1},8,["modelValue","onKeyup"])])),default:(0,r.k6)((()=>[u.isLoading?((0,r.uX)(),(0,r.Wv)(n,{key:0,indeterminate:"",color:"primary",height:"4"})):(0,r.Q3)("",!0),(0,r.bF)(c,{modelValue:d.isShowSuccessAlert,"onUpdate:modelValue":t[0]||(t[0]=e=>d.isShowSuccessAlert=e),timeout:2e3,color:"success"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.alertText),1)])),_:1},8,["modelValue"]),(0,r.bF)(c,{modelValue:d.isShowErrorAlert,"onUpdate:modelValue":t[1]||(t[1]=e=>d.isShowErrorAlert=e),timeout:2e3,color:"error"},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.alertText),1)])),_:1},8,["modelValue"]),(0,r.bF)(g,{headers:d.headers,items:u.productionOrders,"hide-default-footer":"","items-per-page":u.itemsPerPage,"no-data-text":"Список пуст"},{["header.name"]:(0,r.k6)((({column:e})=>[(0,r.Lk)("button",{onClick:t[3]||(t[3]=e=>u.sortBy("product.Name"))},(0,l.v_)(e.title),1),d.sortByColumn===e.value?((0,r.uX)(),(0,r.Wv)(m,{key:0},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,r.Q3)("",!0)])),["header.inProgressCount"]:(0,r.k6)((({column:e})=>[(0,r.Lk)("button",{onClick:t[4]||(t[4]=e=>u.sortBy("inProgressProductsCount"))},(0,l.v_)(e.title),1),d.sortByColumn===e.value?((0,r.uX)(),(0,r.Wv)(m,{key:0},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,r.Q3)("",!0)])),["header.completedCount"]:(0,r.k6)((({column:e})=>[(0,r.Lk)("button",{onClick:t[5]||(t[5]=e=>u.sortBy("completedProductsCount"))},(0,l.v_)(e.title),1),d.sortByColumn===e.value?((0,r.uX)(),(0,r.Wv)(m,{key:0},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,r.Q3)("",!0)])),["header.totalCount"]:(0,r.k6)((({column:e})=>[(0,r.Lk)("button",{onClick:t[6]||(t[6]=e=>u.sortBy("totalProductsCount"))},(0,l.v_)(e.title),1),d.sortByColumn===e.value?((0,r.uX)(),(0,r.Wv)(m,{key:0},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,r.Q3)("",!0)])),["header.status"]:(0,r.k6)((({column:e})=>[(0,r.Lk)("button",{onClick:t=>u.sortBy(e.status)},(0,l.v_)(e.title),9,i),d.sortByColumn===e.value?((0,r.uX)(),(0,r.Wv)(m,{key:0},{default:(0,r.k6)((()=>[(0,r.eW)((0,l.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,r.Q3)("",!0)])),["item.status"]:(0,r.k6)((({value:e,item:t})=>[(0,r.bF)(k,{border:`${u.getColor(e)} thin opacity-25`,color:u.getColor(e),text:t.statusMap,size:"small"},null,8,["border","color","text"])])),["item.actions"]:(0,r.k6)((({item:e})=>[e.completedCount<e.totalCount?((0,r.uX)(),(0,r.Wv)(h,{key:0,size:"small",color:"info",onClick:t=>u.showTaskCreateModal(e),class:"mt-2"},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.eW)("Создать задачу")]))),_:2,__:[10]},1032,["onClick"])):(0,r.Q3)("",!0),(0,r.bF)(h,{size:"small",color:"error",onClick:t=>u.endProductionOrder(e),class:"my-2"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.eW)("Завершить заказ")]))),_:2,__:[11]},1032,["onClick"])])),_:2},1032,["headers","items","items-per-page"]),(0,r.bF)(v,{modelValue:d.currentPage,"onUpdate:modelValue":[t[7]||(t[7]=e=>d.currentPage=e),u.switchPage],length:u.pagesCount,circle:"",color:"primary"},null,8,["modelValue","length","onUpdate:modelValue"])])),_:1}),(0,r.Lk)("template",null,[(0,r.bF)(_,{ref:"productionTaskCreateModal",onSave:u.createTask},null,8,["onSave"])])],64)}const d={class:"mb-2"},u={class:"text-h5"};function n(e,t,o,i,a,n){const c=(0,r.g2)("v-toolbar-title"),m=(0,r.g2)("v-icon"),h=(0,r.g2)("v-btn"),p=(0,r.g2)("v-toolbar"),k=(0,r.g2)("v-text-field"),g=(0,r.g2)("v-select"),v=(0,r.g2)("v-card-text"),C=(0,r.g2)("v-spacer"),_=(0,r.g2)("v-card-actions"),f=(0,r.g2)("v-form"),y=(0,r.g2)("v-card"),b=(0,r.g2)("v-dialog");return(0,r.uX)(),(0,r.Wv)(b,{modelValue:a.isShow,"onUpdate:modelValue":t[1]||(t[1]=e=>a.isShow=e),persistent:"","max-width":"600px"},{default:(0,r.k6)((()=>[(0,r.bF)(y,null,{default:(0,r.k6)((()=>[(0,r.bF)(p,{dark:"",color:"primary"},{default:(0,r.k6)((()=>[(0,r.bF)(c,null,{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("Создание задачи")]))),_:1,__:[2]}),(0,r.bF)(h,{icon:"",dark:"",onClick:n.hide},{default:(0,r.k6)((()=>[(0,r.bF)(m,null,{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)("mdi-close")]))),_:1,__:[3]})])),_:1},8,["onClick"])])),_:1}),(0,r.bF)(f,{onSubmit:(0,s.D$)(n.submitForm,["prevent"])},{default:(0,r.k6)((()=>[(0,r.bF)(v,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",d,[t[4]||(t[4]=(0,r.Lk)("span",{class:"text-h6 font-weight-bold ms-1"},"Изделие: ",-1)),(0,r.Lk)("span",u,(0,l.v_)(a.task.productName),1)]),(0,r.bF)(k,{modelValue:a.task.productsCount,"onUpdate:modelValue":t[0]||(t[0]=e=>a.task.productsCount=e),modelModifiers:{trim:!0},label:"Количество","error-messages":a.errors.count,autocomplete:"off",onChange:n.checkProductCountFieldComplete},null,8,["modelValue","error-messages","onChange"]),(0,r.bF)(g,{items:n.employees,"item-props":n.employeeProps,"onUpdate:modelValue":n.onSelectEmployee,label:"Монтажник РЭА"},null,8,["items","item-props","onUpdate:modelValue"])])),_:1}),(0,r.bF)(_,null,{default:(0,r.k6)((()=>[(0,r.bF)(C),(0,r.bF)(h,{color:"info",type:"submit"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("Создать")]))),_:1,__:[5]}),(0,r.bF)(h,{color:"error",onClick:n.hide},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("Отменить")]))),_:1,__:[6]},8,["onClick"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])}var c={data(){return{isShow:!1,task:{id:0,productName:"",productsCount:"",productId:0,productionOrderId:0,employeeId:0,employee:null},errors:{productName:"",count:"",employee:""}}},computed:{employees(){return this.$store.getters.employees}},methods:{checkEditingFieldsIsvalid(e){this.resetErrors();let t=!0;return 0===e.productsCount.length&&(this.errors.count="Заполните поле count",t=!1),t},checkProductCountFieldComplete(){this.task.productsCount.length>0&&(this.errors.count="")},checkEmployeeFieldComplete(){this.task.employee?this.errors.employee="":this.errors.employee="Выберите сотрудника"},submitForm(){this.checkEditingFieldsIsvalid(this.task)&&this.$emit("save",this.task)},onSelectEmployee(e){this.task.employeeId=e.id},employeeProps(e){return{title:`${e.lastName} ${e.firstName||""} ${e.middleName||" "}`,subtitle:e.status}},show(e){this.resetErrors(),this.task.productionOrderId=e.id,this.task.productId=e.productId,this.task.productName=`${e.productName||""} (${e.productModel||""})`,this.$store.dispatch("loadEmployees"),this.isShow=!0},hide(){this.isShow=!1},resetErrors(){this.errors={count:"",employee:""}}},emits:["save"]},m=o(1241);const h=(0,m.A)(c,[["render",n]]);var p=h,k={components:{ProductionTaskCreateModal:p},data(){return{term:"",isSearchMode:!1,currentPage:1,sortByColumn:"product.Name",sortDesc:!1,headers:[{value:"index",title:"№",width:"10%"},{value:"name",title:"Изделие",width:"20%"},{value:"inProgressCount",title:"в работе (шт)",width:"15%"},{value:"completedCount",title:"собрано (шт)",width:"15%"},{value:"totalCount",title:"всего (шт)",width:"15%"},{value:"status",title:"Статус",width:"10%"},{value:"actions",title:"",width:"15%"}],isShowSuccessAlert:!1,isShowErrorAlert:!1,alertText:""}},created(){this.$store.commit("setSearchParameters",this.term),this.$store.dispatch("loadProductionOrders").catch((()=>{this.showErrorAlert("Ошибка! Не удалось загрузить список производственных заказов.")}))},computed:{productionOrders(){return this.$store.getters.productionOrders},itemsPerPage(){return this.$store.getters.pageSize},pagesCount(){return Math.ceil(this.$store.getters.pageItemsCount/this.itemsPerPage)},isLoading(){return this.$store.getters.isLoading}},methods:{createTask(e){this.$store.dispatch("createProductionTask",e).then((()=>{this.$refs.productionTaskCreateModal.hide(),this.showSuccessAlert("Задача успешно создана.")})).catch((()=>{this.showErrorAlert("Ошибка! Не удалось создать задачу.")}))},showTaskCreateModal(e){this.$refs.productionTaskCreateModal.show(e)},endProductionOrder(e){this.$store.dispatch("deleteProductionOrder",e.id).catch((()=>{this.showErrorAlert("Ошибка! Не удалось завершить производственную задачу. Возможно остались не завершенные задачи.")}))},search(){0!==this.term.length&&(this.$store.commit("setSearchParameters",this.term),this.isSearchMode=!0,this.$store.dispatch("loadProductionOrders").catch((()=>{this.showErrorAlert("Ошибка! Не удалось загрузить список производственных заказов.")})))},cancelSearch(){this.isSearchMode&&(this.term="",this.$store.commit("setSearchParameters",this.term),this.isSearchMode=!1,this.$store.dispatch("loadProductionOrders").catch((()=>{this.showErrorAlert("Ошибка! Не удалось загрузить список производственных заказов.")})))},sortBy(e){this.sortByColumn===e?this.sortDesc=!this.sortDesc:(this.sortDesc=!1,this.sortByColumn=e),this.$store.commit("setSortingParameters",{sortBy:this.sortByColumn,isDesc:this.sortDesc}),this.$store.dispatch("loadProductionOrders").catch((()=>{this.showErrorAlert("Ошибка! Не удалось загрузить список производственных заказов.")}))},switchPage(e){this.$store.commit("setPageNumber",e),this.$store.dispatch("loadProductionOrders").catch((()=>{this.showErrorAlert("Ошибка! Не удалось загрузить список производственных заказов.")}))},getColor(e){return"Pending"===e?"error":"InProgress"===e?"secondary":"success"},showSuccessAlert(e){this.alertText=e,this.isShowSuccessAlert=!0},showErrorAlert(e){this.alertText=e,this.isShowErrorAlert=!0}}};const g=(0,m.A)(k,[["render",a]]);var v=g}}]);
//# sourceMappingURL=347.2aef2f08.js.map