"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[750],{1750:function(e,t,o){o.r(t),o.d(t,{default:function(){return m}});var s=o(6768),r=o(5130),i=o(4232);const l=["onClick"];function a(e,t,o,a,d,c){const n=(0,s.g2)("v-progress-linear"),u=(0,s.g2)("v-icon"),m=(0,s.g2)("v-btn"),h=(0,s.g2)("v-text-field"),p=(0,s.g2)("v-chip"),k=(0,s.g2)("v-data-table"),g=(0,s.g2)("v-card-title"),v=(0,s.g2)("v-card-text"),_=(0,s.g2)("v-card"),C=(0,s.g2)("v-col"),f=(0,s.g2)("v-row"),y=(0,s.g2)("v-container"),b=(0,s.g2)("v-pagination"),$=(0,s.g2)("task-create-modal");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(_,{title:"Очередь производства",flat:""},{text:(0,s.k6)((()=>[(0,s.bF)(h,{modelValue:d.term,"onUpdate:modelValue":t[0]||(t[0]=e=>d.term=e),label:"Найти",autocomplete:"off","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",onKeyup:(0,r.jR)(c.search,["enter"])},{"append-inner":(0,s.k6)((()=>[(0,s.bF)(m,{icon:"",onClick:c.search,color:"primary",size:"small"},{default:(0,s.k6)((()=>[(0,s.bF)(u,null,{default:(0,s.k6)((()=>t[7]||(t[7]=[(0,s.eW)("mdi-magnify")]))),_:1,__:[7]})])),_:1},8,["onClick"]),(0,s.bF)(u,{onClick:c.cancelSearch,style:{cursor:"pointer"},size:"x-large",class:"ms-1 me-2"},{default:(0,s.k6)((()=>t[8]||(t[8]=[(0,s.eW)(" mdi-close-circle ")]))),_:1,__:[8]},8,["onClick"])])),_:1},8,["modelValue","onKeyup"])])),default:(0,s.k6)((()=>[c.isLoading?((0,s.uX)(),(0,s.Wv)(n,{key:0,indeterminate:"",color:"primary",height:"4"})):(0,s.Q3)("",!0),c.isAuthorized?((0,s.uX)(),(0,s.Wv)(k,{key:1,headers:d.headers,items:c.productionOrders,"hide-default-footer":"","items-per-page":c.itemsPerPage,"no-data-text":"Список пуст"},{["header.name"]:(0,s.k6)((({column:e})=>[(0,s.Lk)("button",{onClick:t[1]||(t[1]=e=>c.sortBy("product.Name"))},(0,i.v_)(e.title),1),d.sortByColumn===e.value?((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,s.Q3)("",!0)])),["header.inProgressCount"]:(0,s.k6)((({column:e})=>[(0,s.Lk)("button",{onClick:t[2]||(t[2]=e=>c.sortBy("inProgressProductsCount"))},(0,i.v_)(e.title),1),d.sortByColumn===e.value?((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,s.Q3)("",!0)])),["header.completedCount"]:(0,s.k6)((({column:e})=>[(0,s.Lk)("button",{onClick:t[3]||(t[3]=e=>c.sortBy("completedProductsCount"))},(0,i.v_)(e.title),1),d.sortByColumn===e.value?((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,s.Q3)("",!0)])),["header.totalCount"]:(0,s.k6)((({column:e})=>[(0,s.Lk)("button",{onClick:t[4]||(t[4]=e=>c.sortBy("totalProductsCount"))},(0,i.v_)(e.title),1),d.sortByColumn===e.value?((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,s.Q3)("",!0)])),["header.status"]:(0,s.k6)((({column:e})=>[(0,s.Lk)("button",{onClick:t=>c.sortBy(e.status)},(0,i.v_)(e.title),9,l),d.sortByColumn===e.value?((0,s.uX)(),(0,s.Wv)(u,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(d.sortDesc?"mdi-menu-up":"mdi-menu-down"),1)])),_:1})):(0,s.Q3)("",!0)])),["item.status"]:(0,s.k6)((({value:e,item:t})=>[(0,s.bF)(p,{border:`${c.getColor(e)} thin opacity-25`,color:c.getColor(e),text:t.statusMap,size:"small"},null,8,["border","color","text"])])),["item.actions"]:(0,s.k6)((({item:e})=>[e.completedCount<e.totalCount?((0,s.uX)(),(0,s.Wv)(m,{key:0,size:"small",color:"info",onClick:t=>c.showTaskCreateModal(e),class:"mt-2"},{default:(0,s.k6)((()=>t[9]||(t[9]=[(0,s.eW)("Создать задачу")]))),_:2,__:[9]},1032,["onClick"])):(0,s.Q3)("",!0),(0,s.bF)(m,{size:"small",color:"error",onClick:t=>c.endProductionOrder(e),class:"my-2"},{default:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.eW)("Завершить заказ")]))),_:2,__:[10]},1032,["onClick"])])),_:2},1032,["headers","items","items-per-page"])):((0,s.uX)(),(0,s.Wv)(y,{key:2,class:"fill-height",fluid:""},{default:(0,s.k6)((()=>[(0,s.bF)(f,{align:"center",justify:"center"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{cols:"12",sm:"8",md:"6",lg:"4"},{default:(0,s.k6)((()=>[(0,s.bF)(_,{class:"text-center pa-8"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:(0,s.k6)((()=>t[11]||(t[11]=[(0,s.eW)(" mdi-account-lock ")]))),_:1,__:[11]}),(0,s.bF)(g,{class:"text-h5 justify-center"},{default:(0,s.k6)((()=>t[12]||(t[12]=[(0,s.eW)(" Требуется авторизация ")]))),_:1,__:[12]}),(0,s.bF)(v,null,{default:(0,s.k6)((()=>[t[14]||(t[14]=(0,s.Lk)("p",{class:"text-body-1 mb-4"}," Для просмотра этой страницы необходимо войти в систему ",-1)),(0,s.bF)(m,{color:"primary",onClick:t[5]||(t[5]=e=>c.showLoginModal())},{default:(0,s.k6)((()=>t[13]||(t[13]=[(0,s.eW)(" Войти ")]))),_:1,__:[13]})])),_:1,__:[14]})])),_:1})])),_:1})])),_:1})])),_:1})),(0,s.bF)(b,{modelValue:d.currentPage,"onUpdate:modelValue":[t[6]||(t[6]=e=>d.currentPage=e),c.switchPage],length:c.pagesCount,circle:"",color:"primary"},null,8,["modelValue","length","onUpdate:modelValue"])])),_:1}),(0,s.Lk)("template",null,[(0,s.bF)($,{ref:"taskCreateModal",onSave:c.createTask},null,8,["onSave"])])],64)}var d=o(3e3),c={components:{TaskCreateModal:d.A},data(){return{term:"",isSearchMode:!1,currentPage:1,sortByColumn:"product.Name",sortDesc:!1,headers:[{value:"index",title:"№",width:"10%"},{value:"name",title:"Изделие",width:"20%"},{value:"inProgressCount",title:"в работе (шт)",width:"15%"},{value:"completedCount",title:"собрано (шт)",width:"15%"},{value:"totalCount",title:"всего (шт)",width:"15%"},{value:"status",title:"Статус",width:"10%"},{value:"actions",title:"",width:"15%"}]}},created(){this.isAuthorized&&this.loadData()},computed:{productionOrders(){return this.$store.getters.productionOrders},itemsPerPage(){return this.$store.getters.pageSize},pagesCount(){return Math.ceil(this.$store.getters.pageItemsCount/this.itemsPerPage)},isLoading(){return this.$store.getters.isLoading},isAuthorized(){return this.$store.getters.isAuthorized}},methods:{loadData(){this.$store.commit("setSearchParameters",this.term),this.$store.dispatch("loadProductionOrders").catch((e=>{401===e.status?(this.$store.commit("setAlertMessage","Вы не авторизованы"),this.$store.commit("isShowErrorAlert",!0)):403===e.status?(this.$store.commit("setAlertMessage","У вас нет прав для получения данной информации"),this.$store.commit("isShowErrorAlert",!0)):(this.$store.commit("setAlertMessage","Не удалось загрузить список производственных заказов"),this.$store.commit("isShowErrorAlert",!0))}))},createTask(e){this.$store.dispatch("createProductionTask",e).then((()=>{this.$refs.taskCreateModal.hide(),this.$store.commit("setAlertMessage","Задача успешно создана"),this.$store.commit("isShowSuccessAlert",!0)})).catch((()=>{this.$store.commit("setAlertMessage","Не удалось создать задачу"),this.$store.commit("isShowErrorAlert",!0)}))},showTaskCreateModal(e){this.$refs.taskCreateModal.show(e)},endProductionOrder(e){this.$store.dispatch("deleteProductionOrder",e.id).catch((()=>{this.$store.commit("setAlertMessage","Не удалось завершить производственную задачу. Возможно остались не завершенные задачи"),this.$store.commit("isShowErrorAlert",!0)}))},search(){0!==this.term.length&&(this.$store.commit("setSearchParameters",this.term),this.isSearchMode=!0,this.$store.dispatch("loadProductionOrders").catch((()=>{this.$store.commit("setAlertMessage","Не удалось загрузить список производственных заказов"),this.$store.commit("isShowErrorAlert",!0)})))},cancelSearch(){this.isSearchMode&&(this.term="",this.$store.commit("setSearchParameters",this.term),this.isSearchMode=!1,this.$store.dispatch("loadProductionOrders").catch((()=>{this.$store.commit("setAlertMessage","Не удалось загрузить список производственных заказов"),this.$store.commit("isShowErrorAlert",!0)})))},sortBy(e){this.sortByColumn===e?this.sortDesc=!this.sortDesc:(this.sortDesc=!1,this.sortByColumn=e),this.$store.commit("setSortingParameters",{sortBy:this.sortByColumn,isDesc:this.sortDesc}),this.$store.dispatch("loadProductionOrders").catch((()=>{this.$store.commit("setAlertMessage","Не удалось загрузить список производственных заказов"),this.$store.commit("isShowErrorAlert",!0)}))},switchPage(e){this.$store.commit("setPageNumber",e),this.$store.dispatch("loadProductionOrders").catch((()=>{this.$store.commit("setAlertMessage","Не удалось загрузить список производственных заказов"),this.$store.commit("isShowErrorAlert",!0)}))},getColor(e){return"Pending"===e?"error":"InProgress"===e?"secondary":"success"},showLoginModal(){this.$store.commit("setIsShowLoginModal",!0)}}},n=o(1241);const u=(0,n.A)(c,[["render",a]]);var m=u},3e3:function(e,t,o){o.d(t,{A:function(){return m}});var s=o(6768),r=o(5130),i=o(4232);const l={class:"mb-2"},a={class:"text-h5"};function d(e,t,o,d,c,n){const u=(0,s.g2)("v-toolbar-title"),m=(0,s.g2)("v-icon"),h=(0,s.g2)("v-btn"),p=(0,s.g2)("v-toolbar"),k=(0,s.g2)("v-text-field"),g=(0,s.g2)("v-select"),v=(0,s.g2)("v-card-text"),_=(0,s.g2)("v-spacer"),C=(0,s.g2)("v-card-actions"),f=(0,s.g2)("v-form"),y=(0,s.g2)("v-card"),b=(0,s.g2)("v-dialog");return(0,s.uX)(),(0,s.Wv)(b,{modelValue:c.isShow,"onUpdate:modelValue":t[1]||(t[1]=e=>c.isShow=e),persistent:"","max-width":"600px"},{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(p,{dark:"",color:"primary"},{default:(0,s.k6)((()=>[(0,s.bF)(u,null,{default:(0,s.k6)((()=>t[2]||(t[2]=[(0,s.eW)("Создание задачи")]))),_:1,__:[2]}),(0,s.bF)(h,{icon:"",dark:"",onClick:n.hide},{default:(0,s.k6)((()=>[(0,s.bF)(m,null,{default:(0,s.k6)((()=>t[3]||(t[3]=[(0,s.eW)("mdi-close")]))),_:1,__:[3]})])),_:1},8,["onClick"])])),_:1}),(0,s.bF)(f,{onSubmit:(0,r.D$)(n.submitForm,["prevent"])},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",l,[t[4]||(t[4]=(0,s.Lk)("span",{class:"text-h6 font-weight-bold ms-1"},"Изделие: ",-1)),(0,s.Lk)("span",a,(0,i.v_)(c.task.productName),1)]),(0,s.bF)(k,{modelValue:c.task.productsCount,"onUpdate:modelValue":t[0]||(t[0]=e=>c.task.productsCount=e),modelModifiers:{trim:!0},label:"Количество","error-messages":c.errors.count,autocomplete:"off",onChange:n.checkProductCountFieldComplete},null,8,["modelValue","error-messages","onChange"]),(0,s.bF)(g,{items:n.employees,"item-props":n.employeeProps,"onUpdate:modelValue":n.onSelectEmployee,label:"Монтажник РЭА"},null,8,["items","item-props","onUpdate:modelValue"])])),_:1}),(0,s.bF)(C,null,{default:(0,s.k6)((()=>[(0,s.bF)(_),(0,s.bF)(h,{color:"info",type:"submit"},{default:(0,s.k6)((()=>t[5]||(t[5]=[(0,s.eW)("Создать")]))),_:1,__:[5]}),(0,s.bF)(h,{color:"error",onClick:n.hide},{default:(0,s.k6)((()=>t[6]||(t[6]=[(0,s.eW)("Отменить")]))),_:1,__:[6]},8,["onClick"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])}var c={data(){return{isShow:!1,task:{id:0,productName:"",productsCount:"",productId:0,productionOrderId:0,employeeId:0,employee:null},errors:{productName:"",count:"",employee:""}}},computed:{employees(){return this.$store.getters.employees}},methods:{checkEditingFieldsIsvalid(e){this.resetErrors();let t=!0;return 0===e.productsCount.length&&(this.errors.count="Заполните поле count",t=!1),t},checkProductCountFieldComplete(){this.task.productsCount.length>0&&(this.errors.count="")},checkEmployeeFieldComplete(){this.task.employee?this.errors.employee="":this.errors.employee="Выберите сотрудника"},submitForm(){this.checkEditingFieldsIsvalid(this.task)&&this.$emit("save",this.task)},onSelectEmployee(e){this.task.employeeId=e.id},employeeProps(e){return{title:`${e.lastName} ${e.firstName||""} ${e.middleName||" "}`,subtitle:e.status}},show(e){this.resetErrors(),this.task.productionOrderId=e.id,this.task.productId=e.productId,this.task.productName=`${e.productName||""} (${e.productModel||""})`,this.$store.dispatch("loadEmployees"),this.isShow=!0},hide(){this.isShow=!1},resetErrors(){this.errors={count:"",employee:""}}},emits:["save"]},n=o(1241);const u=(0,n.A)(c,[["render",d]]);var m=u}}]);
//# sourceMappingURL=750.38b1b0c1.js.map